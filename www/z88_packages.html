<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Z88DK - Make z88 Packages</title>
  <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
</head>
<body>
<h2>Z88DK - Writing Z88 Packages</h2>
<br>
<p>At the time of writing, the package subsystem by Garry Lancaster has not
fully been finalised so where differences exist between this document and
the documentation supplied by Garry, his should take precedence.<br>
<br>
A package is always attached to a application eg. The Packege Package is
attached to Installer and the TCP Package is attached to the application
ZSock, thus building a package with z88dk is tied to building an application.
As result this documentation is written with the assumption that you know
how to write and <br>
build applications with z88dk.</p>
<h3>Constructing the Package DOR</h3>
<p>The package DOR is the structure which informs the Package system about
your package. Creating the DOR with z88dk is incredibly simple. Normally
to create an application DOR you would do the following:</p>
<pre>#include &lt;dor.h&gt;<br><br>/* Define application paramaters */<br><br>#include &lt;application.h&gt;</pre>
<p>In a similar manner, to build a package DOR you do the following:</p>
<pre>#include &lt;dor.h&gt;<br><br>/* Define package parameters */<br><br>#include &lt;package.h&gt;<br>/* Define table of pointers to functions (jump table)*/<br><br>/* Define application parameters */<br>#include &lt;application.h&gt;</pre>
<p>The package parameters are as follows:<br>
</p>
<pre>#define MAKE_PACKAGE 1</pre>
<p>Say that you do want to create a package:<br>
</p>
<pre>#define PACK_VERSION&nbsp;&nbsp;&nbsp; $MMmm</pre>
<p>The version of the package you are creating - MM=major, mm=minor<br>
</p>
<pre>#define PACK_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "[name]"</pre>
<p>The name of the package (without the [] of course!)<br>
</p>
<pre>#define PACK_BOOT</pre>
<p>This should be set to either 0 or 1 depending on whether the package<br>
should autoboot or not (This is of course bypassed by holding down 'P'<br>
on reset)<br>
</p>
<pre>#define PACKAGE_ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $xx</pre>
<p>The package number as allocated by Garry Lancaster</p>
<pre>#define MAX_CALL_NUM $nn</pre>
<p>The maximum LSB of a call to your package.</p>
<h3>Setting up the Jump Table</h3>
<p>The jump table can be easily defined using the following construct:</p>
<pre>package_str blahfishcakeblah[] = {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {Func1},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {Func2},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ....<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {FuncN}<br>};</pre>
<p>Remember to prototype as external to the file Func1....FuncN</p>
<h3>Finally</h3>
<p>You have to supply 3 functions yourself to fully define the package, these
are the pack_ayt, pack_bye and pack_dat functions.&nbsp; Due to the complex
entry and exit parameters of these functions they are best written in assembler.
For more details about these calls please see Garry's documentation. These
functions must either be prototyped (to allow correct linking).</p>
<p>At a later date these 3 functions may be writable in C if there's enough
demand for the ability.</p>
<hr width="100%" size="1">
<table cellpadding="2" cellspacing="2" border="0" width="100%">
  <tbody>
    <tr>
      <td valign="Top"><a href="file:///home/dom/z88dk/www/index.html">z88dk</a>
/z88_application.html<br>
      </td>
      <td valign="Top" align="Right">Last Updated 20/1/2002 <a href="mailto:dom@RMME.users.sourceforge.net">
 dom</a><br>
      </td>
    </tr>
  </tbody>
</table>
<p><br>
</p>
<br>
</body>
</html>
